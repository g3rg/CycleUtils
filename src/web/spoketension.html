<html>
<head>
  <title>Average Spoke Tension</title>
  <link type="text/css" rel="stylesheet" href="/style/main.css"/>
  
  <script language="javascript">
  var d = new Array();
  
  function populateData() {
      d["Steel2_6"] = new Array();
      d["Steel2_6"][27]=55;d["Steel2_6"][28]=62;d["Steel2_6"][29]=69;d["Steel2_6"][30]=78;
      d["Steel2_6"][31]=88;d["Steel2_6"][32]=100;d["Steel2_6"][33]=114;d["Steel2_6"][34]=130;
      d["Steel2_6"][35]=150;d["Steel2_6"][36]=172;
      
      d["Steel2_55"] = new Array();
      d["Steel2_55"][26]=54;d["Steel2_55"][27]=60;d["Steel2_55"][28]=67;d["Steel2_55"][29]=76;
      d["Steel2_55"][30]=85;d["Steel2_55"][31]=97;d["Steel2_55"][32]=110;d["Steel2_55"][33]=125;
      d["Steel2_55"][34]=143;d["Steel2_55"][35]=164;
      
      d["Steel2_3"] = new Array();
      d["Steel2_3"][22]=54;d["Steel2_3"][23]=59;d["Steel2_3"][24]=66;d["Steel2_3"][25]=73;
      d["Steel2_3"][26]=82;d["Steel2_3"][27]=92;d["Steel2_3"][28]=104;d["Steel2_3"][29]=117;
      d["Steel2_3"][30]=133;d["Steel2_3"][31]=151;d["Steel2_3"][32]=172;
      
	  d["Steel2_0"] = new Array();
	  d["Steel2_0"][17]=53;d["Steel2_0"][18]=58;d["Steel2_0"][19]=63;d["Steel2_0"][20]=70;
	  d["Steel2_0"][21]=77;d["Steel2_0"][22]=86;d["Steel2_0"][23]=96;d["Steel2_0"][24]=107;
	  d["Steel2_0"][25]=120;d["Steel2_0"][26]=135;d["Steel2_0"][27]=153;d["Steel2_0"][28]=173;
	  
	  d["Steel1_8"] = new Array();
	  d["Steel1_8"][14]=53;d["Steel1_8"][15]=58;d["Steel1_8"][16]=64;d["Steel1_8"][17]=70;
	  d["Steel1_8"][18]=77;d["Steel1_8"][19]=85;d["Steel1_8"][20]=94;d["Steel1_8"][21]=105;
	  d["Steel1_8"][22]=117;d["Steel1_8"][23]=131;d["Steel1_8"][24]=148;d["Steel1_8"][25]=167;
	  
	  d["Steel1_7"] = new Array();
	  d["Steel1_7"][12]=51;d["Steel1_7"][13]=56;d["Steel1_7"][14]=61;d["Steel1_7"][15]=67;
	  d["Steel1_7"][16]=73;d["Steel1_7"][17]=81;d["Steel1_7"][18]=89;d["Steel1_7"][19]=99;
	  d["Steel1_7"][20]=110;d["Steel1_7"][21]=122;d["Steel1_7"][22]=137;d["Steel1_7"][23]=154;
	  d["Steel1_7"][24]=174;
	  
	  d["Steel1_6"] = new Array();
	  d["Steel1_6"][11]=54;d["Steel1_6"][12]=58;d["Steel1_6"][13]=64;d["Steel1_6"][14]=70;
	  d["Steel1_6"][15]=76;d["Steel1_6"][16]=84;d["Steel1_6"][17]=93;d["Steel1_6"][18]=103;
	  d["Steel1_6"][19]=114;d["Steel1_6"][20]=128;d["Steel1_6"][21]=143;d["Steel1_6"][22]=160;
	  
	  d["Steel1_5"] = new Array();
	  d["Steel1_5"][9]=52;d["Steel1_5"][10]=56;d["Steel1_5"][11]=61;d["Steel1_5"][12]=66;
	  d["Steel1_5"][13]=73;d["Steel1_5"][14]=80;d["Steel1_5"][15]=88;d["Steel1_5"][16]=97;
	  d["Steel1_5"][17]=107;d["Steel1_5"][18]=119;d["Steel1_5"][19]=133;d["Steel1_5"][20]=148;
	  d["Steel1_5"][21]=166;
	  
	  d["Steel1_4"] = new Array();
	  d["Steel1_4"][8]=54;d["Steel1_4"][9]=58;d["Steel1_4"][10]=63;d["Steel1_4"][11]=69;
	  d["Steel1_4"][12]=75;d["Steel1_4"][13]=83;d["Steel1_4"][14]=91;d["Steel1_4"][15]=100;
	  d["Steel1_4"][16]=111;d["Steel1_4"][17]=123;d["Steel1_4"][18]=137;d["Steel1_4"][19]=154;
	  d["Steel1_4"][20]=172;
	  
  }

  function convertSpokeTensionReading(spokeType, tensionreading) {
	  var tensionLower = d[spokeType][Math.floor(tensionreading)];
	  var tensionUpper = d[spokeType][Math.floor(tensionreading) + 1];
	  var tensionFraction = (tensionreading - Math.floor(tensionreading))
	                           * (tensionUpper - tensionLower);
	  var finalTension = tensionLower + tensionFraction;
	  
	  return finalTension;
  }
  
  function calculateAverage() {
	  var spokeType = document.getElementById("spoketype").value;
	  
	  var tensions = document.getElementsByName("spoke");
	  
	  var count=0;
	  var total=0;
	  for (var i=0;i<tensions.length;i++){
		if (tensions[i].value != "") {
			spokeTension = parseFloat(tensions[i].value);
			if (isNaN(spokeTension)) {
			  // SET BACKGROUND TO RED?
			} else {
			  total += spokeTension;
			  count++;
			}
		}  
	  }
	  
	  var tension = total / count++;
	  
	  var avg = convertSpokeTensionReading(spokeType, tension);
	  if (isNaN(avg)){
		  document.getElementById("avgTension").value = "ERROR!";
	  } else {
		  document.getElementById("avgTension").value = avg;
	  }
  }
  
  </script>  
</head>
<body onLoad="javascript:populateData()">
  <div>
    <p>
      <label for="spoketype">Spoke Type</label>
      <select name="spoketype" id="spoketype">
        <option value="Steel2_6">Steel Round 2.6mm</option>
        <option value="Steel2_55">Steel Round 2.55mm</option>
        <option value="Steel2_3">Steel Round 2.3mm</option>
        <option value="Steel2_0">Steel Round 2.0mm</option>
        <option value="Steel1_8">Steel Round 1.8mm</option>
        <option value="Steel1_7">Steel Round 1.7mm</option>
        <option value="Steel1_6">Steel Round 1.6mm</option>
        <option value="Steel1_5">Steel Round 1.5mm</option>
        <option value="Steel1_4">Steel Round 1.4mm</option>
      </select>
      <table>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke1" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke2" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke3" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke4" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke5" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke6" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke7" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke8" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke9" name="spoke"/></td><td></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke10" name="spoke"/></td>
      <td><input type="text" id="avgTension" name="avgTension"/></td>
      </tr>
      
      </table>
    </p>
  </div>
</body>
</html>