<html>
<head>
  <title>Average Spoke Tension</title>
  <link type="text/css" rel="stylesheet" href="/style/main.css"/>
  
  <script language="javascript">
  var d = new Array();
  
  function changeSpoke() {
	  var tensions = document.getElementsByName("spoke");
	  var hasValues = false;
      for (var i=0;i<tensions.length;i++){
        if (tensions[i].value != "") {
			hasValues = true;        	
        	break;
        }
      }
      if (hasValues) {
    	  if (confirm("Do you wish to empty all spoke tension fields?")) {
			for (var i=0;i<tensions.length;i++) {
				tensions[i].value = "";
			}
    	  }
      }
      calculateAverage();
  }
  
  function populateData() {
      d["SteelR2_6"] = new Array();
      d["SteelR2_6"][27]=55;d["SteelR2_6"][28]=62;d["SteelR2_6"][29]=69;d["SteelR2_6"][30]=78;
      d["SteelR2_6"][31]=88;d["SteelR2_6"][32]=100;d["SteelR2_6"][33]=114;d["SteelR2_6"][34]=130;
      d["SteelR2_6"][35]=150;d["SteelR2_6"][36]=172;
      
      d["SteelR2_55"] = new Array();
      d["SteelR2_55"][26]=54;d["SteelR2_55"][27]=60;d["SteelR2_55"][28]=67;d["SteelR2_55"][29]=76;
      d["SteelR2_55"][30]=85;d["SteelR2_55"][31]=97;d["SteelR2_55"][32]=110;d["SteelR2_55"][33]=125;
      d["SteelR2_55"][34]=143;d["SteelR2_55"][35]=164;
      
      d["SteelR2_3"] = new Array();
      d["SteelR2_3"][22]=54;d["SteelR2_3"][23]=59;d["SteelR2_3"][24]=66;d["SteelR2_3"][25]=73;
      d["SteelR2_3"][26]=82;d["SteelR2_3"][27]=92;d["SteelR2_3"][28]=104;d["SteelR2_3"][29]=117;
      d["SteelR2_3"][30]=133;d["SteelR2_3"][31]=151;d["SteelR2_3"][32]=172;
      
      d["SteelR2_0"] = new Array();
      d["SteelR2_0"][17]=53;d["SteelR2_0"][18]=58;d["SteelR2_0"][19]=63;d["SteelR2_0"][20]=70;
      d["SteelR2_0"][21]=77;d["SteelR2_0"][22]=86;d["SteelR2_0"][23]=96;d["SteelR2_0"][24]=107;
      d["SteelR2_0"][25]=120;d["SteelR2_0"][26]=135;d["SteelR2_0"][27]=153;d["SteelR2_0"][28]=173;
      
      d["SteelR1_8"] = new Array();
      d["SteelR1_8"][14]=53;d["SteelR1_8"][15]=58;d["SteelR1_8"][16]=64;d["SteelR1_8"][17]=70;
      d["SteelR1_8"][18]=77;d["SteelR1_8"][19]=85;d["SteelR1_8"][20]=94;d["SteelR1_8"][21]=105;
      d["SteelR1_8"][22]=117;d["SteelR1_8"][23]=131;d["SteelR1_8"][24]=148;d["SteelR1_8"][25]=167;
      
      d["SteelR1_7"] = new Array();
      d["SteelR1_7"][12]=51;d["SteelR1_7"][13]=56;d["SteelR1_7"][14]=61;d["SteelR1_7"][15]=67;
      d["SteelR1_7"][16]=73;d["SteelR1_7"][17]=81;d["SteelR1_7"][18]=89;d["SteelR1_7"][19]=99;
      d["SteelR1_7"][20]=110;d["SteelR1_7"][21]=122;d["SteelR1_7"][22]=137;d["SteelR1_7"][23]=154;
      d["SteelR1_7"][24]=174;
      
      d["SteelR1_6"] = new Array();
      d["SteelR1_6"][11]=54;d["SteelR1_6"][12]=58;d["SteelR1_6"][13]=64;d["SteelR1_6"][14]=70;
      d["SteelR1_6"][15]=76;d["SteelR1_6"][16]=84;d["SteelR1_6"][17]=93;d["SteelR1_6"][18]=103;
      d["SteelR1_6"][19]=114;d["SteelR1_6"][20]=128;d["SteelR1_6"][21]=143;d["SteelR1_6"][22]=160;
      
      d["SteelR1_5"] = new Array();
      d["SteelR1_5"][9]=52;d["SteelR1_5"][10]=56;d["SteelR1_5"][11]=61;d["SteelR1_5"][12]=66;
      d["SteelR1_5"][13]=73;d["SteelR1_5"][14]=80;d["SteelR1_5"][15]=88;d["SteelR1_5"][16]=97;
      d["SteelR1_5"][17]=107;d["SteelR1_5"][18]=119;d["SteelR1_5"][19]=133;d["SteelR1_5"][20]=148;
      d["SteelR1_5"][21]=166;
      
      d["SteelR1_4"] = new Array();
      d["SteelR1_4"][8]=54;d["SteelR1_4"][9]=58;d["SteelR1_4"][10]=63;d["SteelR1_4"][11]=69;
      d["SteelR1_4"][12]=75;d["SteelR1_4"][13]=83;d["SteelR1_4"][14]=91;d["SteelR1_4"][15]=100;
      d["SteelR1_4"][16]=111;d["SteelR1_4"][17]=123;d["SteelR1_4"][18]=137;d["SteelR1_4"][19]=154;
      d["SteelR1_4"][20]=172;
      
      d["AluR3_3"] = new Array();
      d["AluR3_3"][33]=56;d["AluR3_3"][34]=65;d["AluR3_3"][35]=76;d["AluR3_3"][36]=89;
      d["AluR3_3"][37]=105;d["AluR3_3"][38]=123;d["AluR3_3"][39]=146;d["AluR3_3"][40]=174;
      
      d["AluR2_8"] = new Array();
      d["AluR2_8"][23]=51;d["AluR2_8"][24]=58;d["AluR2_8"][25]=65;d["AluR2_8"][26]=74;
      d["AluR2_8"][27]=83;d["AluR2_8"][28]=95;d["AluR2_8"][29]=108;d["AluR2_8"][30]=123;
      d["AluR2_8"][31]=141;d["AluR2_8"][32]=162;
      
      d["AluR2_54"] = new Array();
      d["AluR2_54"][15]=50;d["AluR2_54"][16]=57;d["AluR2_54"][17]=64;d["AluR2_54"][18]=73;
      d["AluR2_54"][19]=82;d["AluR2_54"][20]=94;d["AluR2_54"][21]=107;d["AluR2_54"][22]=122;
      d["AluR2_54"][23]=140;d["AluR2_54"][24]=160;
      
      d["AluR2_28"] = new Array();
      d["AluR2_28"][13]=55;d["AluR2_28"][14]=61;d["AluR2_28"][15]=68;d["AluR2_28"][16]=77;
      d["AluR2_28"][17]=86;d["AluR2_28"][18]=96;d["AluR2_28"][19]=108;d["AluR2_28"][20]=121;
      d["AluR2_28"][21]=137;d["AluR2_28"][22]=154;d["AluR2_28"][23]=175;

      d["AluB1_5"] = new Array();
      d["AluB1_5"][7]=52;d["AluB1_5"][8]=58;d["AluB1_5"][9]=65;d["AluB1_5"][10]=72;
      d["AluB1_5"][11]=81;d["AluB1_5"][12]=91;d["AluB1_5"][13]=103;d["AluB1_5"][14]=116;
      d["AluB1_5"][15]=130;d["AluB1_5"][16]=147;d["AluB1_5"][17]=166;

      d["AluB1_8"] = new Array();
      d["AluB1_8"][14]=51;d["AluB1_8"][15]=56;d["AluB1_8"][16]=61;d["AluB1_8"][17]=68;
      d["AluB1_8"][18]=75;d["AluB1_8"][19]=83;d["AluB1_8"][20]=92;d["AluB1_8"][21]=103;
      d["AluB1_8"][22]=115;d["AluB1_8"][23]=130;d["AluB1_8"][24]=146;d["AluB1_8"][25]=165;

      d["AluB1_21"] = new Array();
      d["AluB1_21"][21]=56;d["AluB1_21"][22]=63;d["AluB1_21"][23]=71;d["AluB1_21"][24]=81;
      d["AluB1_21"][25]=92;d["AluB1_21"][26]=104;d["AluB1_21"][27]=118;d["AluB1_21"][28]=134;
      d["AluB1_21"][29]=153;d["AluB1_21"][30]=174;
      
      d["TIRound_2_0"] = new Array();
      d["TIRound_2_0"][15]=52;d["TIRound_2_0"][16]=56;d["TIRound_2_0"][17]=61;d["TIRound_2_0"][18]=66;
      d["TIRound_2_0"][19]=73;d["TIRound_2_0"][20]=80;d["TIRound_2_0"][21]=88;d["TIRound_2_0"][22]=97;
      d["TIRound_2_0"][23]=109;d["TIRound_2_0"][24]=121;d["TIRound_2_0"][25]=136;d["TIRound_2_0"][26]=154;
      d["TIRound_2_0"][27]=174;
      
      d["TIBlade_1_4"] = new Array();
      d["TIBlade_1_4"][9]=53;d["TIBlade_1_4"][10]=57;d["TIBlade_1_4"][11]=62;
      d["TIBlade_1_4"][12]=67;d["TIBlade_1_4"][13]=72;d["TIBlade_1_4"][14]=79;
      d["TIBlade_1_4"][15]=86;d["TIBlade_1_4"][16]=95;d["TIBlade_1_4"][17]=105;
      d["TIBlade_1_4"][18]=116;d["TIBlade_1_4"][19]=129;d["TIBlade_1_4"][20]=143;
      d["TIBlade_1_4"][21]=160;
      
      d["Mavic_R2RCarbon"] = new Array();
      d["Mavic_R2RCarbon"][6]=59;d["Mavic_R2RCarbon"][7]=63;d["Mavic_R2RCarbon"][8]=67;d["Mavic_R2RCarbon"][9]=72;
      d["Mavic_R2RCarbon"][10]=77;d["Mavic_R2RCarbon"][11]=82;d["Mavic_R2RCarbon"][12]=89;
      d["Mavic_R2RCarbon"][13]=96;d["Mavic_R2RCarbon"][14]=105;d["Mavic_R2RCarbon"][15]=119;
      d["Mavic_R2RCarbon"][16]=125;d["Mavic_R2RCarbon"][17]=137;d["Mavic_R2RCarbon"][18]=151;
      
      d["SPO_2_6"] = new Array();
      
      d["SPO_2_6"][10]=51;d["SPO_2_6"][11]=54;d["SPO_2_6"][12]=57;d["SPO_2_6"][13]=61;
      d["SPO_2_6"][14]=64;d["SPO_2_6"][15]=68;d["SPO_2_6"][16]=73;d["SPO_2_6"][17]=77;
      d["SPO_2_6"][18]=83;d["SPO_2_6"][19]=88;d["SPO_2_6"][20]=95;d["SPO_2_6"][21]=102;
      d["SPO_2_6"][22]=109;d["SPO_2_6"][23]=118;d["SPO_2_6"][24]=127;d["SPO_2_6"][25]=137;
      d["SPO_2_6"][26]=148;d["SPO_2_6"][27]=160;d["SPO_2_6"][28]=174;
      
  }

  function convertSpokeTensionReading(spokeType, tensionreading) {
      var tensionLower = d[spokeType][Math.floor(tensionreading)];
      var tensionUpper = d[spokeType][Math.floor(tensionreading) + 1];
      var tensionFraction = (tensionreading - Math.floor(tensionreading))
                               * (tensionUpper - tensionLower);
      var finalTension = tensionLower + tensionFraction;
      
      return finalTension;
  }
  
  function calculateAverage() {
      var spokeType = document.getElementById("spoketype").value;
      if (spokeType != "") {
	      var tensions = document.getElementsByName("spoke");
	      
	      var count=0;
	      var total=0;
	      for (var i=0;i<tensions.length;i++){
	        if (tensions[i].value != "") {
	            spokeTension = parseFloat(tensions[i].value);
	            if (isNaN(spokeTension)) {
	              // SET BACKGROUND TO RED?
	            
	            } else {
	              total += spokeTension;
	              count++;
	            }
	        }  
	      }
      }
      
      var tension = total / count++;
      
      var avg = convertSpokeTensionReading(spokeType, tension);
      if (isNaN(avg)){
          document.getElementById("avgTension").value = "ERROR!";
      } else {
          document.getElementById("avgTension").value = avg;
      }
  }
  
  </script>  
</head>
<body onLoad="javascript:populateData()">
  <div>
      <H3>Average Spoke Tension Calculator</H3>
      <label for="spoketype"><H6>Choose the spoke type and size</H6></label>
      <select name="spoketype" id="spoketype" onChange="changeSpoke()">
        <option value="SteelR2_6">Steel Round 2.6mm</option>
        <option value="SteelR2_55">Steel Round 2.55mm</option>
        <option value="SteelR2_3">Steel Round 2.3mm</option>
        <option value="SteelR2_0">Steel Round 2.0mm</option>
        <option value="SteelR1_8">Steel Round 1.8mm</option>
        <option value="SteelR1_7">Steel Round 1.7mm</option>
        <option value="SteelR1_6">Steel Round 1.6mm</option>
        <option value="SteelR1_5">Steel Round 1.5mm</option>
        <option value="SteelR1_4">Steel Round 1.4mm</option>
        <option value="">-----------</option>
        <option value="AluR3_3">Aluminium Round 3.3mm</option>
        <option value="AluR2_8">Aluminium Round 2.8mm</option>
        <option value="AluR2_54">Aluminium Round 2.54mm</option>
        <option value="AluR2_28">Aluminium Round 2.28mm</option>
        <option value="">-----------</option>
        <option value="AluB1_5">Aluminium Blade 1.5 x 3.9mm</option>
        <option value="AluB1_8">Aluminium Blade 1.8 x 5.3mm</option>
        <option value="AluB2_1">Aluminium Blade 2.1 x 4.3mm</option>
        <option value="">-----------</option>
        <option value="TIRound_2_0">Ti Round 2.0mm</option>
        <option value="TIBlade_1_4">Ti Blade 1.4 x 2.6mm</option>
        <option value="Mavic_R2RCarbon">Mavic R2R Carbon Blade</option>
        <option value="SPO_2_6">SPO Spinnergy Round 2.6mm</option>
		<option value="">-----------</option>
      </select>
      <h6>Enter tension readings from Park Tools TM-1</h6>
      <table>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke1" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke2" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke3" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke4" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke5" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke6" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke7" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke8" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke9" name="spoke"/></td></tr>
      <tr><td><input type="text" onChange="javascript:calculateAverage()" id="spoke10" name="spoke"/></td></tr>
      <tr><td><input type="text" id="avgTension" name="avgTension" disabled=true/> Average KGF</td></tr>
      
      </table>
  </div>
</body>
</html>